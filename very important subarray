question====>https://www.codechef.com/problems/SUMSUB

video editorial===>https://youtu.be/m90_ZZQlE1M




#include<bits/stdc++.h>
#define int long long 
using namespace std;
const int mod = 1e9+7;

int mod_mul(int a, int b) {a = a % mod; b = b % mod; return (((a * b) % mod) + mod) % mod;}

int mod_add(int a, int b) {a = a % mod; b = b % mod; return (((a + b) % mod) + mod) % mod;}

signed main(){
    int t;
    cin>>t;
    while(t--){
        int n;
        cin>>n;
        vector<int>a(n+1,0);
        for(int i=1;i<=n;i++){
            cin>>a[i];
        }
        vector<int>next(n+1,n+1);
        stack<pair<int,int>>st;
        st.push({LLONG_MAX,LLONG_MAX});
        for(int i=1;i<=n;i++){
            while(a[i]>=st.top().first ){
                next[st.top().second]=i;
                st.pop();
            }
            st.push({a[i],i});
        }
        
        // for(int i=1;i<=n;i++){
        //     cout<<next[i]<<" ";
        // }
        
        vector<int>dp(n+3,0);
        for(int i=n;i>=1;i--){
            int num = next[i]-i;
            dp[i]=mod_mul(a[i],num*(num+1)/2);
            dp[i]=mod_add(dp[i],mod_mul(num*a[i],n-next[i]+1));
            dp[i]=mod_add(dp[i],dp[next[i]]);
        }
        int ans = 0;
        for(int i=1;i<=n;i++){
            ans = mod_add(ans,dp[i]);
        }
        cout<<ans<<"\n";
    }
    return 0;
}
